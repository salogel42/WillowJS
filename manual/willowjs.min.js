/*! willowjs 2013-03-20 */
if("undefined"!=typeof module&&"undefined"!=typeof require)var fractionUtils=require("./fractionUtils.js").fractionUtils,utils=require("./utils.js").utils,getPrecedence=require("./expr.js").getPrecedence,errorNode=require("./utils.js").errorNode;var parenMode={full:0,terms:1,necessary:2},outputType={text:0,mathml:1,latex:2},divSign={never:0,notNumeric:1,always:2},display=function(){function e(e){return"unary"===e.type||"compound"===e.type}function r(e){var i=utils.getSide(e);return null===e.parent||"="===e.parent.op?!0:t(e.parent,e)?!0:"left"!==i?!1:r(e.parent)}function t(i,o){if(null===i||null===o)return!1;if("unary"===o.type&&"|"===o.op)return!1;if(("unary"===o.type||"compound"===o.type)&&"\\sqrt"===o.op)return!1;if("/"===i.op&&x===divSign.never&&h!==outputType.text)return!1;var n="";if(fractionUtils.isNegativeNumber(o))n="-";else{if(!e(o))return!1;n=o.op}if(0===getPrecedence(i.op))return!1;if(f===parenMode.full)return!0;if(utils.isUnaryNegative(i))return 2>getPrecedence(o.op);var s=utils.getSide(o);if("-"===n&&"^"===i.op&&"left"===s)return!0;if("^"===i.op&&"right"===s&&h!==outputType.text)return!1;if(("unary"===o.type||"number"===o.type)&&"-"===n&&("unary"===o.type&&t(o,o.child)||"left"===s&&r(i)))return!1;var a=getPrecedence(i.op),p=getPrecedence(n);return f===parenMode.necessary?a>p||a===p&&"right"===s&&("-"===i.op||"^"===i.op||"/"===i.op&&(x!==divSign.never||h===outputType.text)):!(("/"===i.op||"/"===n)&&x===divSign.never&&h!==outputType.text)&&(a>p||a===p)}function i(e,r,t){return h!==outputType.mathml?e:t?("\\infty"===e&&(e="&#x221E;"),"<mi id=node"+r+">"+e+"</mi>"):"<mn id=node"+r+">"+e+"</mn>"}function o(e,r){return h===outputType.text||""===e?e:("*"===e&&(e=h===outputType.mathml?"&#8729;":"\\cdot"),"<="===e&&(e=h===outputType.mathml?"&#x2264;":"\\le"),">="===e&&(e=h===outputType.mathml?"&#x2265;":"\\ge"),"!="===e&&(e=h===outputType.mathml?"&#x2260;":"\\ne"),h===outputType.latex?e:'<mo class="op" id=node'+r+">"+e+"</mo>")}function n(e,r,t,i){var n=x===divSign.always||x===divSign.notNumeric&&!i;if(h===outputType.text){var s="/";return n&&(s="รท"),e+s+r}return h===outputType.latex?n?e+"\\div"+r:"\\frac{"+e+"}{"+r+"}":n?e+o("&#xF7;",t)+r:"<mfrac id=node"+t+"><mrow>"+e+"</mrow><mrow>"+r+"</mrow></mfrac>"}function s(e,r){var t="";return 2===r&&(r=""),h===outputType.mathml?t="<mroot>"+e+r+"</mroot>":(t="\\sqrt",""!==r&&(t+="["+r+"]"),t+="{"+e+"}"),t}function a(e,r){return null===e?!1:"number"===e.type?!0:"unary"===e.type?"-"===e.op?a(e.child,r):!1:"compound"===e.type?"^"===e.op&&"right"===r&&h!==outputType.text?!1:"left"===r?a(e.lhs,r):a(e.rhs,r):!1}function p(e){return"compound"!==e.type?!1:"/"===e.op?!0:p(e.rhs)}function u(e,r){return null===e.parent||"number"===e.type||"identifier"===e.type?!1:null===e?!1:t(e.parent,e)?!0:"left"===r?u(e.lhs,r):u(e.rhs,r)}function l(r){if(h!==outputType.text&&"compound"===r.type&&("compound"===r.lhs.type&&"^"===r.lhs.op||"compound"===r.rhs.type&&"^"===r.rhs.op&&"number"!==r.lhs.type))return!1;if(h!==outputType.text&&"compound"===r.type&&e(r.lhs)&&e(r.rhs)&&"compound"===r.lhs.type&&"^"===r.lhs.op)return!1;if(utils.isSimpleExpression(r.lhs)&&utils.isSimpleExpression(r.rhs)||"compound"===r.type&&(t(r,r.lhs)||t(r,r.rhs)))return!1;if(fractionUtils.isNegativeNumber(r.rhs)||"unary"===r.rhs.type&&"-"===r.rhs.op&&"number"===r.rhs.child.type)return!0;if(x===divSign.never){var i=p(r);if(i)return h===outputType.text}return"compound"===r.lhs.type&&a(r.lhs,"right")&&!u(r.lhs,"right")||"compound"===r.rhs.type&&a(r.rhs,"left")&&!u(r.rhs,"left")}function c(e,r){var t="";if(fractionUtils.isValueFraction(e)){var o=c(e.top,r),a=c(e.bottom,r),p="number"==typeof e.top||"number"==typeof e.bottom;t=n(o,a,r,p)}else if(fractionUtils.isValueRadical(e)){var u=c(e.radicand,r),l=c(fractionUtils.invertFraction(e.power),r);t=s(u,l,r)}else t=i(e,r,!1);return t}function d(e,r){return h!==outputType.mathml&&/\\[a-zA-Z]+$/.test(e)&&/^[a-zA-Z]/.test(r)&&(e+=" "),e}function m(e){if("identifier"===e.type)return i(e.value,e.id,!0);var r="";"number"===e.type&&(r=c(e.value,e.id));var a="";if((f===parenMode.full||"*"!==e.op||"compound"===e.type&&"*"===e.op&&(null===e.lhs||null===e.rhs||"number"===e.lhs.type&&"number"===e.rhs.type||l(e)))&&(a=e.op,a=o(a,e.id)),"\\sqrt"===e.op){var p=e.lhs,u=e.rhs;"unary"===e.type&&(p=null,u=e.child),"number"===u.type&&-1===u.value?r=i("i",e.id,!0):(p=null===p?"":m(p),u=m(u),r=s(u,p,e.id))}else if("compound"===e.type){var v=null===e.lhs?"":m(e.lhs),y=null===e.rhs?"":m(e.rhs);a=d(a,y),v=d(v,a+y),r=v+a+y,"^"===e.op&&f!==parenMode.full&&h!==outputType.text?h===outputType.mathml?r="<msup id=node"+e.id+">"+v+y+"</msup>":h===outputType.latex&&(y.length>1&&(y="{"+y+"}"),r=v+"^"+y):"/"===e.op&&(r=n(v,y,e.id,!1))}else if(utils.isUnaryNegative(e))r=a+m(e.child);else if(utils.isAbsValue(e))switch(r=m(e.child),h){case outputType.text:r="|"+r+"|";break;case outputType.latex:r="\\left|"+r+"\\right|";break;case outputType.mathml:r="<mfenced open='|' close='|' id=node"+e.id+"><mrow>"+r+"</mrow></mfenced>"}else if("ternary"===e.type){var E=m(e.left),g=m(e.middle),b=m(e.right),N=d(o(e.op1,e.id),g),C=d(o(e.op2,e.id),b);E=d(E,N+g),g=d(g,C+b),r=E+N+g+C+b}return null!==e.parent&&(t(e.parent,e)?r=h===outputType.mathml?"<mfenced id=node"+e.id+"><mrow>"+r+"</mrow></mfenced>":h===outputType.latex?"\\left("+r+"\\right)":"("+r+")":h!==outputType.mathml||"number"===e.type||x===divSign.never&&"/"===e.op||"^"===e.op||(r="<mrow id=node"+e.id+">"+r+"</mrow>")),r}var f=parenMode.terms,h=outputType.mathml,x=divSign.never,v={displayExpression:function(e,r,t,i){if(null===e||e===errorNode)return"";x=i!==void 0?i:divSign.never,f=t!==void 0?t:parenMode.necessary,h=r!==void 0?r:outputType.latex;var o=m(e);if(h===outputType.mathml){var n="math`";expr!==void 0&&expr.nextId!==void 0&&(n=expr.nextId++),o='<math xmlns="http://www.w3.org/1998/Math/MathML" id=node'+n+">"+o+"</math>"}return""+o}};return v}();if("undefined"!=typeof exports&&(exports.display=display,exports.parenMode=parenMode,exports.outputType=outputType,exports.divSign=divSign),"undefined"!=typeof module&&"undefined"!=typeof require){var getPrecedence=require("./expr.js").getPrecedence,utils=require("./utils.js"),errorNode=utils.errorNode;utils=utils.utils;var operatorProperties=require("./expr.js").operatorProperties,expr=require("./expr.js").expr,fractionUtils=require("./fractionUtils.js").fractionUtils}var equality=function(){function e(r,t){var i=expr.makeCommutativeIfNecessary(r);if(utils.isSimpleExpression(i)||i.op!==t||"unary"===i.type)return[i];var o=i.lhs,n=i.rhs;return e(o,t).concat(e(n,t))}function r(e,r,t){if(e.length!==r.length)return!1;for(var i=0;e.length>i;i++){for(var o=e[i],n=r.length,a=!1,u=0;r.length>u;u++)if(s(o,r[u])){if(p&&"*"===t&&"number"===o.type&&(0!==u||0!==i))return!1;r.splice(u,1),a=!0;break}if(r.length===n)return!1}return 0===r.length}function t(e){return"compound"===e.type&&1===getPrecedence(e.op)?"compound"===e.type&&"+"===e.op&&utils.isUnaryNegative(e.rhs)||t(e.lhs)||t(e.rhs):"unary"===e.type?t(e.child):"compound"===e.type?t(e.lhs)||t(e.rhs):"ternary"===e.type?t(e.left)||t(e.middle)||t(e.right):!1}function i(e){return"compound"===e.type&&2===getPrecedence(e.op)?i(e.lhs):e}function o(e){if(e=a(e),fractionUtils.isNegativeNumber(e))return expr.createUnaryExpression(expr.createSimpleExpression("number",fractionUtils.additiveInverseOfFraction(e.value)),"-");if("unary"===e.type)return expr.createUnaryExpression(o(e.child),e.op);if("ternary"===e.type)return expr.createTernaryExpression(o(e.left),o(e.middle),o(e.right),e.op1,e.op2);if("compound"!==e.type)return e;var r=expr.createCompoundExpression(o(e.lhs),o(e.rhs),e.op);if(2!==getPrecedence(e.op))return r;var t=i(r);if(fractionUtils.isNodeNegative(t)){e=expr.copyNode(r),t=i(r);var n=t.child;return fractionUtils.isNegativeNumber(t)&&(n=equality.additiveInverseOfNumber(t)),utils.setChild(n,t.parent,"left"),expr.createUnaryExpression(r,"-")}return r}function n(e){return p?o(e):u.normalizeTermSign(e)}function s(t,i){if(i===errorNode||t===errorNode)return!1;if(i.syntacticEquals(t))return!0;if(i.type===t.type){if(utils.isSimpleExpression(i))return fractionUtils.compareFractions(i.value,t.value,!0);if("unary"===i.type)return i.op===t.op&&s(i.child,t.child);if("ternary"===t.type)return s(t.left,i.left)&&s(t.middle,i.middle)&&s(t.right,i.right);if(i=expr.makeCommutativeIfNecessary(i),t=expr.makeCommutativeIfNecessary(t),i.op!==t.op){if(operatorProperties.getInverseInequality(t.op)!==i.op)return!1;i=expr.createCompoundExpression(i.rhs,i.lhs,t.op)}if(!operatorProperties[i.op].commutative)return s(t.lhs,i.lhs)&&s(t.rhs,i.rhs);var o=e(i,i.op),n=e(t,t.op);return r(o,n,t.op)}return!1}function a(e){if("compound"===e.type&&"/"===e.op&&"number"===e.rhs.type&&"number"!==e.lhs.type){var r=u.splitCoefficientFromRest(e.lhs,!0);if(null!==r){var t=null===r.co?1:r.co.value;e=expr.createSimpleExpression("number",fractionUtils.createFractionValue(t,e.rhs.value)),null!==r.rest&&(e=expr.createCompoundExpression(e,r.rest,"*"))}}return e}var p=!1,u={splitCoefficientFromRest:function(e,r){if(r===void 0&&(r=!1),"number"===e.type)return{co:e,rest:null};if("compound"===e.type&&"*"===e.op&&!utils.isOneOverSomething(e)){if("number"===e.lhs.type&&"number"===e.rhs.type)return null;if("number"===e.lhs.type)return{co:e.lhs,rest:e.rhs};if("number"===e.rhs.type)return{co:e.rhs,rest:e.lhs};var t=u.splitCoefficientFromRest(e.lhs,r),i=u.splitCoefficientFromRest(e.rhs,r);if(null===t||null===i||null!==t.co&&null!==i.co||null===t.co&&null===i.co)return null;if(null!==i.co){var o=i;i=t,t=o}var n={co:t.co,rest:t.rest};return null!==i.rest&&(n.rest=null===t.rest?i.rest:expr.createCompoundExpression(t.rest,i.rest)),n}return"compound"!==e.type||2===getPrecedence(e.op)||r?{co:null,rest:e}:null},additiveInverseOfNumber:function(e){return"number"!==e.type?null:operatorProperties["-"].unaryEvaluate(e)},convertFractionToCompoundExpression:function(e){return fractionUtils.isNodeFraction(e)?expr.createCompoundExpression(expr.createSimpleExpression("number",e.value.top),expr.createSimpleExpression("number",e.value.bottom),"/"):e},normalizeTermSign:function(e){if(e=a(e),"identifier"===e.type)return expr.copyNode(e);if("number"===e.type)return fractionUtils.isNegativeNumber(e)?expr.createUnaryExpression(u.additiveInverseOfNumber(e),"-"):expr.copyNode(e);if("unary"===e.type){var r=u.normalizeTermSign(e.child);return utils.isUnaryNegative(r)?r.child:expr.createUnaryExpression(r,e.op)}if("ternary"===e.type)return expr.createTernaryExpression(u.normalizeTermSign(e.left),u.normalizeTermSign(e.middle),u.normalizeTermSign(e.right),e.op1,e.op2);if("compound"===e.type){var t=u.normalizeTermSign(e.lhs),i=u.normalizeTermSign(e.rhs);return 2!==getPrecedence(e.op)?expr.createCompoundExpression(t,i,e.op):utils.isUnaryNegative(t)&&utils.isUnaryNegative(i)?expr.createCompoundExpression(t.child,i.child,e.op):utils.isUnaryNegative(t)||utils.isUnaryNegative(i)?(utils.isUnaryNegative(t)&&(t=t.child),utils.isUnaryNegative(i)&&(i=i.child),expr.createUnaryExpression(expr.createCompoundExpression(t,i,e.op),"-")):expr.createCompoundExpression(t,i,e.op)}},equivalentModuloCommutativity:function(e,r,i){if(e===errorNode||r===errorNode)return!1;p=i;var o=n(r),a=n(e);return p&&(t(o)||t(a))?!1:s(a,o)}};return u}();if("undefined"!=typeof exports&&(exports.equality=equality),"undefined"!=typeof module&&"undefined"!=typeof require){var display=require("./display.js"),parenMode=display.parenMode,outputType=display.outputType;display=display.display;var expr=require("./expr.js").expr,utils=require("./utils.js"),errorNode=utils.errorNode;utils=utils.utils;var equality=require("./equality.js").equality,getPrecedence=require("./expr.js").getPrecedence,fractionUtils=require("./fractionUtils.js").fractionUtils,parser=require("./parser.js").parser,operatorProperties=require("./expr.js").operatorProperties}var equalityType={verbatim:0,commuteCo:1,commute:2,full:3,fullEq:4,none:5},evaluate=function(){function e(e,r,t){t&&console.log(e+display.displayExpression(r,outputType.text,parenMode.full))}function r(e){return"number"===e.type?expr.createSimpleExpression("number",fractionUtils.invertFraction(e.value)):"compound"===e.type&&"/"===e.op?"number"===e.lhs.type&&1===e.lhs.value?e.rhs:expr.createCompoundExpression(e.rhs,e.lhs,"/"):expr.createCompoundExpression(expr.createSimpleExpression("number",1),e,"/")}function t(e){for(var t=0;e.length>t;t++)e[t]=r(e[t]);return e}function i(e){if("identifier"===e.type)return[e];if(utils.isUnaryNegative(e))return i(e.child);if("number"===e.type&&fractionUtils.isValueRadical(e.value))return[e];if("compound"!==e.type)return[];if(2>getPrecedence(e.op))return[e];var r=i(e.lhs);if("^"===e.op){if("number"!==e.rhs.type||!(fractionUtils.isInteger(e.rhs.value)||fractionUtils.isNodeFraction(e.rhs)&&Math.abs(e.rhs.value.top)>Math.abs(e.rhs.value.bottom))){for(var o=[],n=0;r.length>n;n++)o.push(expr.createCompoundExpression(r[n],e.rhs,"^"));return o}if(fractionUtils.isNodeNegative(e.rhs))return t(r)}var s=i(e.rhs);return"*"===e.op&&(r=r.concat(s)),"/"===e.op&&(r=r.concat(t(s))),r}function o(e,r){return e.syntacticEquals(r)?!0:"unary"===e.type?o(e.child,r):"compound"===e.type?o(e.lhs,r)||o(e.rhs,r):!1}function n(e){e=e.sort();for(var r=[];e.length>0;){for(var t=e.shift(),i=!1,o=0;e.length>o;o++)("number"===t.type&&"number"===e[o].type||t.syntacticEquals(e[o]))&&(i=!0,e.splice(o--,1));i&&r.push(t)}return r}function s(e){if("identifier"===e.type)return[e];if("number"===e.type)return[e];if(utils.isUnaryNegative(e))return s(e.child);if("compound"!==e.type||2>getPrecedence(e.op))return[];var r=s(e.lhs);if("^"===e.op)return r;var t=s(e.rhs);return r.concat(t)}function a(e){return"compound"===e.type&&"^"===e.op?e.rhs:expr.createSimpleExpression("number",1)}function p(e,r,t,i){if(null===r)return e;if(null===e){if("/"!==t)return r;var o=a(r);return expr.createCompoundExpression(i,expr.arithmeticEvaluation(expr.createCompoundExpression(expr.createSimpleExpression("number",-1),o,"*")),"^")}if("identifier"===e.type&&"identifier"===r.type&&e.value===r.value){if("*"===t)return expr.createCompoundExpression(e,expr.createSimpleExpression("number",2),"^");if("/"===t)return expr.createSimpleExpression("number",1)}var n=a(e),s=a(r);return"/"===t&&(s=expr.arithmeticEvaluation(expr.createCompoundExpression(expr.createSimpleExpression("number",-1),s,"*"))),expr.arithmeticEvaluation(expr.createCompoundExpression(i,evaluate.evaluateRec(expr.createCompoundExpression(n,s,"+")),"^"))}function u(e,t,i,o){if(null===t)return e;if(null===e)return"/"===i?r(t):t;var n=expr.createCompoundExpression(e,t,i);return o?evaluate.evaluateRec(n):n}function l(e,r){return r.syntacticEquals(e)||"compound"===e.type&&"^"===e.op&&r.syntacticEquals(e.lhs)}function c(e,r){var t=e,i=null;return l(e,r)||("compound"===e.type&&l(e.lhs,r)&&getPrecedence(e.op)>1?(t=e.lhs,i=e.rhs):(t=null,i=e)),{identifierGroup:t,restOfExpression:i}}function d(r,t){if(e("pulling ",t,K),e(" to left of ",r,K),l(r,t))return r;if(utils.isUnaryNegative(r))return expr.createCompoundExpression(r.child,expr.createSimpleExpression("number",-1),"*");if("compound"!==r.type||2>getPrecedence(r.op))return r;if("^"===r.op&&!t.syntacticEquals(r.lhs)){var i=d(expr.makeCommutativeIfNecessary(r.lhs),t);if(t.syntacticEquals(i))return d(expr.createCompoundExpression(i,r.rhs,"^"),t);if("compound"===i.type&&"*"===i.op){var o=c(i,t);if(null!==o.identifierGroup){var n=expr.createCompoundExpression(o.identifierGroup,r.rhs,"^");return"compound"===o.identifierGroup.type&&"^"===o.identifierGroup.op&&(n=expr.createCompoundExpression(o.identifierGroup.lhs,expr.createCompoundExpression(o.identifierGroup.rhs,r.rhs,"*"),"^")),expr.createCompoundExpression(n,expr.createCompoundExpression(o.restOfExpression,r.rhs,"^"),"*")}}return r}var s=r.lhs,a=r.rhs;l(s,t)||(s=d(r.lhs,t)),l(a,t)||(a=d(r.rhs,t));var m=c(s,t),f=c(a,t),h=p(m.identifierGroup,f.identifierGroup,r.op,t),x=u(m.restOfExpression,f.restOfExpression,r.op,!1);return u(h,x,"*",!1)}function m(e){if("number"===e.type)return e;if(utils.isUnaryNegative(e))return equality.additiveInverseOfNumber(m(e.child));if("compound"!==e.type)return null;if("^"===e.op)return null;var t=m(e.lhs),i=m(e.rhs);return 2===getPrecedence(e.op)?null!==t&&null!==i?expr.arithmeticEvaluation(expr.createCompoundExpression(t,i,e.op),!1):null!==t?t:null!==i?"/"===e.op?r(i):i:null:1===getPrecedence(e.op)?null!==t&&null!==i&&"number"===t.type&&"number"===i.type?expr.createSimpleExpression("number",fractionUtils.fractionGCD(t.value,i.value)):null:null}function f(t){if(e("grouping ",t,K),t=expr.rationalizeDenominator(t),"compound"===t.type&&"/"===t.op){var i=m(t.lhs),o=m(t.rhs);if(null!==i&&null!==o&&"number"===i.type&&"number"===o.type){var a=fractionUtils.fractionGCD(i.value,o.value);1!==a&&(a=r(expr.createSimpleExpression("number",a)),t=expr.createCompoundExpression(S(expr.createCompoundExpression(a,t.lhs,"*")),S(expr.createCompoundExpression(a,t.rhs,"*")),t.op))}}if("compound"===t.type&&2===getPrecedence(t.op)){t=expr.makeCommutativeIfNecessary(t);for(var p=n(s(t));p.length>0;)t=d(t,p.shift()),"compound"===t.type&&"^"===t.op&&"number"===t.lhs.type&&1!==A(t.rhs)&&(t=evaluate.evaluateRec(t))}return t}function h(e,r,t){return t*(e.value===r.value?0:e.value<r.value?-1:1)}function x(e,r,t,i,o){var n=E(e,r,o);return 0===n?E(t,i,o):n}function v(e,r){if("compound"===e.type){if("/"===e.op)return equality.equivalentModuloCommutativity(r,e.rhs,!1);if("*"===e.op)return v(e.lhs,r)||v(e.rhs,r)}return!1}function y(e,r){var t=operatorProperties["-"].evaluateValues(e,r);return 0===t.value?0:fractionUtils.isNegative(t.value)?-1:1}function E(r,t,i){if(e("checking ",r,Y),e(" against ",t,Y),equality.equivalentModuloCommutativity(r,t,!1))return 0;if("compound"===r.type&&"compound"===t.type&&"/"===r.op&&"/"===t.op)return E(r.rhs,t.rhs,i);if("compound"===r.type&&"/"===r.op)return v(t,r.rhs)?0:-1;if("compound"===t.type&&"/"===t.op)return v(r,t.rhs)?0:1;if("number"===r.type&&"number"===t.type){if(fractionUtils.isValueRadical(r.value)&&fractionUtils.isValueRadical(t.value)){if(fractionUtils.compareFractions(r.value,t.value,!0))return 0;var o=y(r.value.radicand,t.value.radicand);return 0===o?y(r.value.power,t.value.power):o}return fractionUtils.isValueRadical(r.value)?1:fractionUtils.isValueRadical(t.value)?-1:y(r.value,t.value)}if("number"===r.type&&!fractionUtils.isValueRadical(r.value)||"number"===t.type&&!fractionUtils.isValueRadical(t.value))return"number"===r.type?-1:1;if("identifier"===r.type&&"identifier"===t.type)return h(r,t,i);if(utils.isUnaryNegative(r))return E(r.child,t,i);if(utils.isUnaryNegative(t))return E(r,t.child,i);if("unary"===r.type&&"unary"===t.type)return r.op===t.op?E(r.child,t.child):"|"===r.op?-1:1;if("unary"===r.type)return-1;if("unary"===r.type)return 1;if("compound"===r.type&&"compound"===t.type&&2!==getPrecedence(r.op)&&2!==getPrecedence(t.op)){if("^"===r.op&&"^"===t.op)return x(r.lhs,t.lhs,r.rhs,t.rhs,i);if(1===getPrecedence(r.op)&&1===getPrecedence(t.op))return r=q(r,!1),t=q(t,!1),x(r.lhs,t.lhs,r.rhs,t.rhs,i);if(1===getPrecedence(r.op))return 1;if(1===getPrecedence(t.op))return-1;if("\\sqrt"===r.op&&"\\sqrt"===t.op)return x(r.rhs,t.rhs,r.lhs,t.lhs,i);if("\\sqrt"===r.op)return-1;if("\\sqrt"===t.op)return 1}var n=C(r,"*",!1),s=C(t,"*",!1);for(n=n.sort(g),s=s.sort(g);n.length>0&&s.length>0;){if(r=n.shift(),t=s.shift(),e("checking nth terms ",r,Y),e(" against ",t,Y),"identifier"===r.type&&"compound"===t.type){var a="^"===t.op?E(r,t.lhs,i):1*i;return 0!==a?a:1*i}if("compound"===r.type&&"identifier"===t.type){var p="^"===r.op?E(r.lhs,t,i):-1*i;return 0!==p?p:-1*i}var u=E(r,t,i);if(0!==u)return u;if("compound"===r.type&&"/"===r.op)return 0}return n.length>0?i:s.length>0?-1*i:0}function g(e,r){return E(e,r,1)}function b(e,r){return-1*E(e,r,-1)}function N(e,r){for(var t=0;e.length>t;t++)e[t]=expr.createUnaryExpression(e[t],r);return e}function C(e,r,i){if("number"===e.type)return fractionUtils.isValueRadical(e.value)?[e]:i?[e]:[];if("identifier"===e.type)return[e];if("unary"===e.type){if("-"!==e.op&&e.op!==r)return[e];var o=C(e.child,r,i);return i&&e.op!==r?N(o,e.op):o}if(getPrecedence(e.op)!==getPrecedence(r))return[e];var n=C(e.lhs,r,i),s=C(e.rhs,r,i);return"/"===e.op?e.op!==r&&utils.isOneOverSomething(e)?t(s):n.concat(t(s)):n.concat(s)}function U(e,r,t){return utils.isSimpleExpression(e)?[e]:utils.isUnaryNegative(e)?2!==getPrecedence(r)?[expr.createUnaryExpression(q(e.child,t),"-")]:U(e.child,t).concat([expr.createSimpleExpression("number",-1)]):"unary"===e.type||e.op!==r?[q(e,t)]:U(e.lhs,r,t).concat(U(e.rhs,r,t))}function q(r,t){if(r===errorNode||utils.isSimpleExpression(r))return r;if("unary"===r.type&&"|"===r.op){var i=q(r.child,t);return t&&fractionUtils.isNodeNegative(I(F(i)))&&(i=S(expr.createUnaryExpression(i,"-"),!0)),expr.createUnaryExpression(i,"|")}if("ternary"===r.type)return expr.createTernaryExpression(q(r.left,t),q(r.middle,t),q(r.right,t),r.op1,r.op2);var o=getPrecedence(r.op),n=U(r,r.op,t);if(1===n.length)return n[0];var s=null;1===o&&(s=b),2===o&&"/"!==r.op&&(s=g),null!==s&&(n=n.sort(s));var a=n[0];if(t){if(a=n[n.length-1],n.length>1){for(var p=n[n.length-2],u=p,l=n.length-3;l>=0;l--)null!==s&&0===s(u,n[l])?(u=n[l],p=expr.createCompoundExpression(n[l],p,r.op)):(a=expr.createCompoundExpression(p,a,r.op),u=n[l],p=n[l]);a=expr.createCompoundExpression(p,a,r.op)}}else for(var c=1;n.length>c;c++){if(0!==getPrecedence(r.op)&&(n[c]=equality.normalizeTermSign(n[c])),n[c]=z(n[c]),"+"===r.op&&utils.isUnaryNegative(n[c]))a=expr.createCompoundExpression(a,n[c].child,"-");else if("+"===r.op&&"number"===n[c].type&&fractionUtils.isNegative(n[c].value))a=expr.createCompoundExpression(a,equality.additiveInverseOfNumber(n[c]),"-");else if(2===getPrecedence(r.op)&&utils.isNegativeOne(n[c]))a=expr.createUnaryExpression(a,"-");else if("*"===r.op&&utils.isNegativeOne(a))a=expr.createUnaryExpression(n[c],"-");else if("*"===r.op&&utils.isUnaryNegative(a))a=expr.createUnaryExpression(expr.createCompoundExpression(a.child,n[c],r.op),"-");else if("*"===r.op&&utils.isUnaryNegative(n[c]))a=expr.createUnaryExpression(expr.createCompoundExpression(a,n[c].child,r.op),"-");else{if("*"===r.op&&"compound"===a.type&&"/"===a.op)return expr.createCompoundExpression(expr.arithmeticEvaluation(expr.createCompoundExpression(a.lhs,n[c],"*")),a.rhs,"/");"/"===r.op&&"compound"===a.type&&"/"===a.op?a=expr.createCompoundExpression(a.lhs,q(expr.createCompoundExpression(a.rhs,n[c],"*")),"/"):"/"===r.op&&"compound"===n[c].type&&"/"===n[c].op?(a=expr.arithmeticEvaluation(expr.createCompoundExpression(a,n[c].rhs,"*")),("number"!==n[c].lhs||1!==n[c].lhs)&&(a=expr.createCompoundExpression(a,n[c].lhs,"/"))):a="compound"===n[c].type&&"^"===n[c].op&&(utils.isUnaryNegative(n[c].rhs)||"number"===n[c].rhs.type&&fractionUtils.isNegative(n[c].rhs.value))?"/"===r.op?expr.createCompoundExpression(a,L(n[c]),"*"):expr.createCompoundExpression(a,W(n[c]),r.op):expr.createCompoundExpression(a,n[c],r.op)}a=W(a),e("after flip: ",a,H),a=z(a),e("after sqrt: ",a,H),a=expr.arithmeticEvaluation(a,!1),e("after arith: ",a,H)}return a}function V(r){if(e("simplifying node: ",r,Q),"identifier"===r.type||"number"===r.type)return r;if("compound"===r.type){r=expr.makeCommutativeIfNecessary(r);var t=V(r.lhs),o=V(r.rhs);if(t===errorNode||o===errorNode)return errorNode;r=expr.createCompoundExpression(t,o,r.op);var n=r.evaluateArithmetic(!0);if(null!==n)return n;if("+"===r.op){for(var s=i(r.lhs),a=i(r.rhs),p=null,u=0;s.length>u;u++)for(var l=0;a.length>l;l++)if(s[u].syntacticEquals(a[l])){p=s[u];break}if(null!==p){e("commonIdentifier: ",p,Q);var c=r.lhs,d=expr.arithmeticEvaluation(r.rhs);if(e("commLhs: ",c,Q),e("commRhs: ",d,Q),c=rr.pullIdentfierToLhs(c,p),"compound"===c.type&&"^"===c.op)return r;if(d=rr.pullIdentfierToLhs(d,p),"compound"===d.type&&"^"===d.op)return r;d=expr.createCompoundExpression(c.rhs,d.rhs,r.op),e("newLhs: ",c,Q),e("newRhs: ",d,Q),r=V(expr.createCompoundExpression(c.lhs,evaluate.evaluateRec(d),"*"))}else"+"===r.op&&utils.isUnaryNegative(r.rhs)?r=expr.createCompoundExpression(r.lhs,r.rhs.child,"-"):"+"===r.op&&"number"===r.rhs.type&&fractionUtils.isNegative(r.rhs.value)&&(r=expr.createCompoundExpression(r.lhs,equality.additiveInverseOfNumber(r.rhs),"-"))}return e("returning simplified: ",r,Q),r}if("unary"===r.type){var m=V(r.child);return m===errorNode?errorNode:(r=expr.createUnaryExpression(m,r.op),expr.arithmeticEvaluation(r,!0))}if("ternary"===r.type){var f=V(r.left),h=V(r.middle),x=V(r.right);return expr.createTernaryExpression(f,h,x,r.op1,r.op2)}return console.error("about to return errorNode"),errorNode}function P(r,t){if(e("combining ",r,_),"compound"===r.type&&2===getPrecedence(t)&&!utils.isOneOverSomething(r)){var i=equality.splitCoefficientFromRest(r.lhs),o=equality.splitCoefficientFromRest(r.rhs);if(null===i||null===o)return r;var n=u(i.co,o.co,t,!1);if(null!==n&&(n=expr.arithmeticEvaluation(n),e("coefficient: ",n,_)),"/"===t&&null===i.rest&&null!==o.rest)return u(n,o.rest,"/",!1);var s=u(i.rest,o.rest,t,!1);return e("rest: ",s,_),u(n,s,"*",!1)}return r}function S(t,i){if(e("fullMultiplying: ",t,Z),"identifier"===t.type||"number"===t.type)return expr.arithmeticEvaluation(t);if("ternary"===t.type)return expr.createTernaryExpression(S(t.left,i),S(t.middle,i),S(t.right,i),t.op1,t.op2);if("compound"===t.type){t=expr.makeAdditionCommutative(t);var o=S(t.lhs,i),n=S(t.rhs,i);if(e("left: ",o,Z),e("right: ",n,Z),o===errorNode||n===errorNode)return errorNode;t=expr.createCompoundExpression(o,n,t.op);var s=t.evaluateArithmetic(!0);if(e("arithmetic: ",s,Z),null!==s)return s;if(i&&(t=P(t,t.op)),"/"===t.op)return f(t);if("\\sqrt"===t.op)return S(expr.createCompoundExpression(t.rhs,r(t.lhs),"^"));if(i&&"^"===t.op&&"compound"===t.rhs.type){if(1===getPrecedence(t.rhs.op)){var a=t.rhs.rhs;return"-"===t.rhs.op&&(a=equality.additiveInverseOfNumber(a)),expr.createCompoundExpression(S(expr.createCompoundExpression(t.lhs,t.rhs.lhs,"^"),i),S(expr.createCompoundExpression(t.lhs,a,"^"),i),"*")}if("*"===t.rhs.op&&"number"===t.lhs.type&&1!==A(t.rhs))return S(expr.createCompoundExpression(S(expr.createCompoundExpression(t.lhs,t.rhs.lhs,"^"),i),t.rhs.rhs,"^"),i)}if("^"===t.op&&"compound"===t.lhs.type){if("^"===t.lhs.op)return S(expr.createCompoundExpression(t.lhs.lhs,S(expr.createCompoundExpression(t.lhs.rhs,t.rhs,"*"),i),"^"),i);if(2===getPrecedence(t.lhs.op))return S(expr.createCompoundExpression(S(expr.createCompoundExpression(t.lhs.lhs,t.rhs,"^"),i),S(expr.createCompoundExpression(t.lhs.rhs,t.rhs,"^"),i),t.lhs.op),i);if(1===getPrecedence(t.lhs.op)&&"number"===t.rhs.type&&!fractionUtils.isValueFraction(t.rhs.value)&&!fractionUtils.isValueRadical(t.rhs.value))return S(evaluate.splitPowerNumberExponent(t),i)}if("^"===t.op&&fractionUtils.isNodeNegative(t.rhs))return r(S(expr.createCompoundExpression(t.lhs,S(expr.createUnaryExpression(t.rhs,"-")),"^")));if("*"===t.op){if(!i){if("compound"===t.lhs.type&&"/"===t.lhs.op&&fractionUtils.isNodeFraction(t.rhs))return f(expr.createCompoundExpression(S(expr.createCompoundExpression(t.lhs.lhs,expr.createSimpleExpression("number",t.rhs.value.top),"*"),i),S(expr.createCompoundExpression(t.lhs.rhs,expr.createSimpleExpression("number",t.rhs.value.bottom),"*"),i),"/"));if("compound"===t.rhs.type&&"/"===t.rhs.op&&fractionUtils.isNodeFraction(t.lhs))return f(expr.createCompoundExpression(S(expr.createCompoundExpression(t.rhs.lhs,expr.createSimpleExpression("number",t.lhs.value.top),"*"),i),S(expr.createCompoundExpression(t.rhs.rhs,expr.createSimpleExpression("number",t.lhs.value.bottom),"*"),i),"/"));if("compound"===t.lhs.type&&"/"===t.lhs.op){var p=t.rhs;return("number"!==t.lhs.lhs.type||1!==t.lhs.lhs.value)&&(p=S(expr.createCompoundExpression(t.lhs.lhs,t.rhs,"*"),i)),expr.createCompoundExpression(p,t.lhs.rhs,"/")}if("compound"===t.rhs.type&&"/"===t.rhs.op){var u=t.lhs;return("number"!==t.rhs.lhs.type||1!==t.rhs.lhs.value)&&(u=S(expr.createCompoundExpression(t.lhs,t.rhs.lhs,"*"),i)),expr.createCompoundExpression(u,t.rhs.rhs,"/")}}if("compound"===t.lhs.type&&1===getPrecedence(t.lhs.op))return t.lhs=expr.makeCommutativeIfNecessary(t.lhs),S(expr.createCompoundExpression(S(expr.createCompoundExpression(t.lhs.lhs,t.rhs,"*"),i),S(expr.createCompoundExpression(t.lhs.rhs,t.rhs,"*"),i),t.lhs.op),i);if("compound"===t.rhs.type&&1===getPrecedence(t.rhs.op))return t.rhs=expr.makeCommutativeIfNecessary(t.rhs),S(expr.createCompoundExpression(S(expr.createCompoundExpression(t.lhs,t.rhs.lhs,"*"),i),S(expr.createCompoundExpression(t.lhs,t.rhs.rhs,"*"),i),t.rhs.op),i)}t=f(t)}if("unary"===t.type){var l=S(t.child,i);if(l===errorNode)return errorNode;if("\\sqrt"===t.op){var c=expr.createSimpleExpression("number",fractionUtils.createFractionValue(1,2));return S(expr.createCompoundExpression(l,c,"^"))}if(t=expr.createUnaryExpression(l,t.op),"-"!==t.op)return t;var d=t.evaluateArithmetic(i);return null!==d?S(d,i):t}return t}function F(e){return"compound"!==e.type||1!==getPrecedence(e.op)?e:F(e.lhs)}function R(e){var r={base:e,power:1};return"compound"===e.type&&"^"===e.op&&"number"===e.rhs.type&&(r.base=e.lhs,r.power=e.rhs.value),r}function w(r,t){e("checking: ",r,J),e(" and ",t,J);var i=R(t),o=R(r);return i.base.syntacticEquals(o.base)&&(J&&console.log("bases are the same! powers: "+o.power+" and "+i.power),o.power>=i.power)?(J&&console.log("powers right!"),expr.arithmeticEvaluation(expr.createCompoundExpression(i.base,expr.createSimpleExpression("number",o.power-i.power),"^"),!1)):null}function T(e){return"compound"===e.type&&"/"===e.op&&"number"===e.lhs.type&&"number"===e.rhs.type}function I(e){return e.numeric?e:"compound"!==e.type?e:T(e)?operatorProperties["/"].evaluate(e.lhs,e.rhs):2!==getPrecedence(e.op)?e:I(e.lhs)}function k(e){if("number"===e.type){if(fractionUtils.isValueRadical(e.value))return expr.createSimpleExpression("number",1)}else{if(utils.isUnaryNegative(e))return expr.arithmeticEvaluation(expr.createUnaryExpression(k(e.child),"-"));if("compound"===e.type&&2===getPrecedence(e.op))return expr.arithmeticEvaluation(expr.createCompoundExpression(k(e.lhs),k(e.rhs),e.op))}return e}function A(e,r){if("boolean"!=typeof r&&(r=!0),e.numeric)return r?e:k(e);if("compound"===e.type&&"/"===e.op)return operatorProperties["/"].evaluate(A(e.lhs,r),A(e.rhs,r));var t=I(e);return utils.isUnaryNegative(t)?equality.additiveInverseOfNumber(A(t.child,r)):"number"!==t.type||!r&&fractionUtils.isValueRadical(t.value)?expr.createSimpleExpression("number",1):t}function M(r,t,i){e("dividend: ",r,J),e(" divisor: ",t,J);for(var o=F(t),n=F(r),s=C(o,"*",!1),a=C(n,"*",!1),p=[];s.length>0;){for(var u=s.shift(),l=!1,c=0;a.length>c;c++){var d=w(a[c],u);if(null!==d){e("quo: ",d,J),p.push(d),a.splice(c,1),l=!0;break}}if(!l)return{result:null,success:!1}}p=p.concat(a);var m=operatorProperties["/"].evaluate(A(n,!1),A(o,!1));for(J&&(e("leadingTermTop: ",n,J),e("leadingTermBottom: ",o,J),console.log("top: "+A(n,!1).value+" bottom: "+A(o,!1).value),e("coefficients: ",m,J));p.length>0;)m=expr.createCompoundExpression(m,p.shift(),"*"),m=expr.arithmeticEvaluation(m,!1);e("multTerm: ",m,J);var f=evaluate.evaluateRec(expr.createCompoundExpression(m,t,"*"),!1);e("mult: ",f,J);var h=evaluate.evaluateRec(expr.createCompoundExpression(r,f,"-"));if(e("sub: ",h,J),"number"===h.type&&0===h.value)return{result:m,success:!0};if(h.syntacticEquals(r))return console.log("somehow got back to myself?"),{result:null,success:!1};var x=M(h,t,i),v=x.result;return!x.success&&i&&(J&&console.log("there was a remainder"),v=evaluate.evaluateRec(expr.createCompoundExpression(h,t,"/")),x.success=!0),x.success&&(J&&console.log("no remainder"),x.result=expr.createCompoundExpression(m,v,"+")),x}function O(e){return"compound"===e.type&&"/"===e.op&&"number"!==e.rhs.type}function j(r){if("unary"===r.type){var t=j(r.child);if(O(t))return expr.createCompoundExpression(expr.createUnaryExpression(t.lhs,r.op),t.rhs,"/")}if("compound"!==r.type||0===getPrecedence(r.op)||"^"===r.op)return r;var i=j(r.lhs),o=j(r.rhs);if(!O(i)&&!O(o))return r;var n=i,s=o,a=null,p=null;
if(O(i)&&(n=i.lhs,a=i.rhs),O(o)&&(s=o.lhs,p=o.rhs),2===getPrecedence(r.op)){if("/"===r.op){var l=s;s=p,p=l}return expr.createCompoundExpression(u(n,s,"*",!0),u(a,p,"*",!0),"/")}if(1===getPrecedence(r.op)){var c=u(a,p,"*",!0);n=u(n,p,"*",!1),s=u(a,s,"*",!1);var d=evaluate.evaluateRec(expr.createCompoundExpression(n,s,r.op));return e("top: ",d,J),expr.createCompoundExpression(d,c,"/")}}function G(r,t){if("ternary"===r.type)return r;var i=r;r=expr.copyNode(r);var o=0;if(J&&(o="before: "+display.displayExpression(r,0,2)),r=j(r),J&&!i.syntacticEquals(r)&&(console.log(o),e("after: ",r,J)),r===errorNode||utils.isSimpleExpression(r))return r;if("unary"===r.type)return expr.createUnaryExpression(G(r.child,t),r.op);if("/"===r.op){if("number"===r.rhs.type)return r;var n=M(r.lhs,r.rhs,t);return n.success===!0?(J&&console.log("dividing whole thing worked!"),n.result=q(n.result),e("result: ",n.result,J),n.result):(J&&console.log("dividing whole thing did not work :("),i)}var s=expr.copyNode(r.lhs),a=expr.copyNode(r.rhs),p=G(r.lhs,t),u=G(r.rhs,t);return p.syntacticEquals(s)&&u.syntacticEquals(a)?r:rr.evaluateRec(expr.createCompoundExpression(p,u,r.op))}function L(e){var r=e;return"compound"===e.type&&"^"===e.op&&"number"===e.rhs.type&&fractionUtils.isNegative(e.rhs.value)&&(r=expr.createCompoundExpression(e.lhs,equality.additiveInverseOfNumber(e.rhs),"^")),"compound"===e.type&&"^"===e.op&&utils.isUnaryNegative(e.rhs)&&(r=expr.createCompoundExpression(e.lhs,e.rhs.child,"^")),expr.arithmeticEvaluation(r)}function W(e){return"compound"===e.type&&"^"===e.op&&(utils.isUnaryNegative(e.rhs)||"number"===e.rhs.type&&fractionUtils.isNegative(e.rhs.value))?expr.createCompoundExpression(expr.createSimpleExpression("number",1),L(e),"/"):e}function z(e){if("compound"===e.type&&"^"===e.op){if("number"===e.rhs.type&&fractionUtils.isValueFraction(e.rhs.value))return e.rhs.value===fractionUtils.createFractionValue(1,2)?expr.createUnaryExpression(e.lhs,"\\sqrt"):expr.createCompoundExpression(expr.createSimpleExpression("number",e.rhs.value.bottom),expr.arithmeticEvaluation(expr.createCompoundExpression(e.lhs,expr.createSimpleExpression("number",e.rhs.value.top),"^")),"\\sqrt");if("compound"===e.rhs.type&&"/"===e.rhs.op)return expr.createCompoundExpression(e.rhs.rhs,expr.arithmeticEvaluation(expr.createCompoundExpression(e.lhs,e.rhs.lhs,"^")),"\\sqrt")}return e}function D(r,t){if(e("node:",r,er),e("other:",r,er),"compound"===r.type&&"compound"===t.type){var i="+";if(0===getPrecedence(r.op)&&0===getPrecedence(t.op)){if(r.op!==t.op&&operatorProperties.getInverseInequality(r.op)!==t.op)return!1;i=r.op;var o=t.lhs,n=t.rhs;if(operatorProperties.getInverseInequality(r.op)===t.op&&(o=t.rhs,n=t.lhs),r=evaluate.evaluateRec(expr.createCompoundExpression(r.lhs,r.rhs,"-")),t=evaluate.evaluateRec(expr.createCompoundExpression(o,n,"-")),equality.equivalentModuloCommutativity(r,t,!1))return!0}var s=rr.doSyntheticDivision(r,t,!0);return"number"===s.type&&("="===i||0!==getPrecedence(i)&&1===s.value||0===getPrecedence(i)&&!fractionUtils.isNegative(s.value))}return"ternary"===r.type&&"ternary"===t.type?D(expr.createCompoundExpression(r.left,r.middle,r.op1),expr.createCompoundExpression(t.left,t.middle,t.op1))&&D(expr.createCompoundExpression(r.middle,r.right,r.op2),expr.createCompoundExpression(t.middle,t.right,t.op2)):!1}function B(e,t){if(e.lhs.syntacticEquals(t))return[e];if("unary"===e.lhs.type&&"-"===e.lhs.op)return B(expr.createCompoundExpression(e.lhs.child,expr.createUnaryExpression(e.rhs,"-"),operatorProperties.getInverseInequality(e.op)),t);if("\\sqrt"===e.lhs.op||"^"===e.lhs.op){var i=z(e.lhs);if("\\sqrt"===i.op){var n=i.lhs,s=i.rhs;return"unary"===i.type&&(s=e.child,n=expr.createSimpleExpression("number",2)),B(expr.createCompoundExpression(s,expr.createCompoundExpression(e.rhs,n,"^"),e.op),t)}if("number"===e.lhs.rhs.type){var a=expr.createCompoundExpression(e.lhs.rhs,e.rhs,"\\sqrt");return fractionUtils.isEven(e.lhs.rhs.value)?B(expr.createCompoundExpression(e.lhs.lhs,a,e.op),t).concat(B(expr.createCompoundExpression(e.lhs.lhs,expr.createUnaryExpression(a,"-"),e.op),t)):B(expr.createCompoundExpression(e.lhs.lhs,a,e.op),t)}return[e]}if("compound"===e.lhs.type){if(!o(e.lhs.rhs,t))return B(expr.createCompoundExpression(e.lhs.lhs,expr.createCompoundExpression(e.rhs,e.lhs.rhs,operatorProperties.inverseOp(e.lhs.op)),e.op),t);if(!o(e.lhs.lhs,t)){if(utils.isOneOverSomething(e.lhs))return B(expr.createCompoundExpression(e.lhs.rhs,r(e.rhs),operatorProperties.getInverseInequality(e.op)),t);var p=expr.makeCommutativeIfNecessary(e.lhs);return B(expr.createCompoundExpression(p.rhs,expr.createCompoundExpression(e.rhs,p.lhs,operatorProperties.inverseOp(e.lhs.op)),e.op),t)}}return[e]}var $=!1,Z=!1,X=!1,H=!1,J=!1,K=!1,Q=!1,Y=!1,_=!1,er=!1,rr={pullIdentfierToLhs:function(t,i){if(e("Pulling ",i,Q),e(" to the left of ",t,Q),t.syntacticEquals(i))t=expr.createCompoundExpression(t,expr.createSimpleExpression("number",1),"*");else{if(utils.isUnaryNegative(t)){var o=rr.pullIdentfierToLhs(t.child,i);return t=expr.createCompoundExpression(o,expr.createSimpleExpression("number",-1),"*"),rr.pullIdentfierToLhs(t,i)}if("compound"!==t.type)return t;if("^"===t.op&&"number"===t.rhs.type&&!fractionUtils.isValueRadical(t.rhs.value)){var n=t.lhs;return n.syntacticEquals(i)?rr.splitPowerNumberExponent(t):(n=rr.pullIdentfierToLhs(t.lhs,i),"compound"===n.type&&i.syntacticEquals(n.lhs)?expr.createCompoundExpression(rr.splitPowerNumberExponent(expr.createCompoundExpression(n.lhs,t.rhs,"^")),expr.createCompoundExpression(n.rhs,t.rhs,"^"),"*"):t)}if(i.syntacticEquals(t.lhs))return t;if("*"===t.op&&i.syntacticEquals(t.rhs))return rr.pullIdentfierToLhs(t.commute(),i);var s=rr.pullIdentfierToLhs(t.lhs,i);if("compound"===s.type&&i.syntacticEquals(s.lhs))s=expr.makeCommutativeIfNecessary(s),t=expr.makeCommutativeIfNecessary(t),t=expr.createCompoundExpression(s.lhs,expr.createCompoundExpression(s.rhs,t.rhs,"*"),"*");else{"/"===t.op&&(i=r(i));var a=rr.pullIdentfierToLhs(t.rhs,i);"compound"!==a.type||!i.syntacticEquals(a.lhs)||"^"===t.op&&(fractionUtils.isNodeFraction(a.rhs)||fractionUtils.isValueRadical(a.rhs))||(e("we have found it and newRhs is: ",a,Q),e("at this point, node is: ",t,Q),s=a.lhs,a=expr.makeCommutativeIfNecessary(a),"/"===t.op&&(s=r(s)),t=expr.createCompoundExpression(s,expr.createCompoundExpression(t.lhs,a.rhs,t.op),"*"))}}return t},splitPowerNumberExponent:function(e){if("^"!==e.op||"number"!==e.rhs.type||fractionUtils.isValueRadical(e.rhs.value))return e;if(-1===e.rhs.value)return expr.createCompoundExpression(expr.createSimpleExpression("number",1),e.lhs,"/");if(-1>e.rhs.value)return W(e);if(0===e.rhs.value)return expr.createSimpleExpression("number",1);if(1===e.rhs.value)return e.lhs;if(2===e.rhs.value)return expr.createCompoundExpression(e.lhs,e.lhs,"*");var r=operatorProperties["-"].evaluateValues(e.rhs.value,1);return fractionUtils.isNodeNegative(r)?e:expr.createCompoundExpression(e.lhs,expr.createCompoundExpression(e.lhs,r,"^"),"*")},fullEquality:function(e,r){return equality.equivalentModuloCommutativity(rr.evaluateRec(expr.copyNode(e)),rr.evaluateRec(expr.copyNode(r),!1))},doSyntheticDivision:function(e,r,t){return G(expr.createCompoundExpression(e,r,"/"),t)},evaluateRec:function(r){return r===errorNode?errorNode:(e("init:",r,$),r=S(r,!0),e("mult1:",r,$),r=q(r,!0),e("sort1:",r,$),r=V(r),e("simp:",r,$),r=S(r,!1),e("mult2:",r,$),r=q(r,!1),e("sort2:",r,$),r=G(r,!1),e("synth:",r,$),r)},evaluateFull:function(e){var r=e.parent,t=utils.getSide(e),i=rr.evaluateRec(e);return i===errorNode?i:i.syntacticEquals(e)?null:(utils.setChild(i,r,t),i)},equivalentEquationOrInequality:function(e,r){return e=rr.evaluateRec(e),r=rr.evaluateRec(r),equality.equivalentModuloCommutativity(e,r)?!0:D(e,r)},strictestEqualityType:function(e,r,t){return e===errorNode||r===errorNode?equalityType.none:e.syntacticEquals(r)?equalityType.verbatim:equality.equivalentModuloCommutativity(e,r,!0)?equalityType.commuteCo:equality.equivalentModuloCommutativity(e,r,!1)?equalityType.commute:(e=rr.evaluateRec(e),r=rr.evaluateRec(r),equality.equivalentModuloCommutativity(e,r,!1)?equalityType.full:t&&D(e,r)?equalityType.fullEq:equalityType.none)},substituteNodeForOtherNode:function(e,r,t){return e===errorNode||r===errorNode||t===errorNode?errorNode:e.syntacticEquals(r)?expr.copyNode(t):utils.isSimpleExpression(e)?expr.copyNode(e):"unary"===e.type?expr.createUnaryExpression(rr.substituteNodeForOtherNode(e.child,r,t),e.op):"compound"===e.type?expr.createCompoundExpression(rr.substituteNodeForOtherNode(e.lhs,r,t),rr.substituteNodeForOtherNode(e.rhs,r,t),e.op):void 0},expandExponent:function(e){var r=null;if(e!==errorNode&&"^"===e.op&&"number"===e.rhs.type){var t=e.parent,i=utils.getSide(e);r=rr.splitPowerNumberExponent(e),utils.setChild(r,t,i)}return r},solveForIdentifier:function(e,r){if(X&&(console.log(display.displayExpression(e,0,2)),console.log(display.displayExpression(r,0,2))),"compound"!==e.type||0!==getPrecedence(e.op)||!o(e,r))return[e];var t=expr.copyNode(e);t=evaluate.evaluateRec(expr.createCompoundExpression(expr.createCompoundExpression(t.lhs,t.rhs,"-"),expr.createSimpleExpression("number",0),e.op)),X&&console.log(display.displayExpression(t,0,2));var i=B(t,r);t=[];for(var n=0;i.length>n;n++)X&&console.log(display.displayExpression(i[n],0,2)),t.push(evaluate.evaluateRec(i[n]));return t},getAllTermsAtLevel:function(e,r){e=expr.makeCommutativeIfNecessaryRec(e,e.op);var t=C(e,e.op,!0);return r&&(t=t.sort(b)),{operator:e.op,terms:t}},getAllIdentifiers:function(e){return"identifier"===e.type?[e.value]:"unary"===e.type?rr.getAllIdentifiers(e.child):"compound"===e.type?rr.getAllIdentifiers(e.lhs).concat(rr.getAllIdentifiers(e.rhs)):"ternary"===e.type?rr.getAllIdentifiers(e.left).concat(rr.getAllIdentifiers(e.middle).concat(rr.getAllIdentifiers(e.right))):[]}};return rr}();if("undefined"!=typeof module&&"undefined"!=typeof exports&&(exports.evaluate=evaluate,exports.equalityType=equalityType),"undefined"!=typeof module&&"undefined"!=typeof require)var utils=require("./utils.js").utils,errorNode=require("./utils.js").errorNode,fractionUtils=require("./fractionUtils").fractionUtils;var expr=function(){function e(e,r,t,i,o,n){this.identity=e,this.precedence=r,this.commutative=t,this.associative=i,this.evaluate=o,this.evaluateValues=n}function r(e){return"\\cdot"===e?"*":"\\div"===e?"/":e}function t(e,r){return null===r?e:null===e?r:expr.createCompoundExpression(e,r,"*")}function i(e){if("number"===e.type&&fractionUtils.isValueRadical(e.value))return{radical:e,rest:null};if("compound"===e.type&&"*"===e.op){var r=i(e.lhs),o=i(e.rhs);return{radical:t(r.radical,o.radical),rest:t(r.rest,o.rest)}}return{radical:null,rest:e}}function o(e){if(fractionUtils.isValueFraction(e.radicand))return s.operatorProperties["/"].evaluate(o(fractionUtils.createRadicalValue(e.radicand.top,e.power)),o(fractionUtils.createRadicalValue(e.radicand.bottom,e.power)));var r=fractionUtils.simplifyRadical(e);return fractionUtils.isValueMixed(r)?(r=s.operatorProperties["*"].evaluateValues(r.rational,r.radical),r.simplified=!0,r):s.makeNumber(r)}function n(e){if("compound"===e.type&&"*"===e.op){var r=n(e.lhs),t=n(e.rhs);if("number"===r.type&&fractionUtils.isValueRadical(r.value)&&"number"===t.type&&fractionUtils.isValueRadical(t.value)){var i=fractionUtils.combineRadicals(r.value,t.value);if(i!==errorNode)return newNode=o(i),0>fractionUtils.computeApproxNumericValue(r.value.radicand)&&0>fractionUtils.computeApproxNumericValue(t.value.radicand)&&(newNode=s.operatorProperties["-"].unaryEvaluate(newNode)),newNode}return expr.createCompoundExpression(r,t,"*")}return e}var s={compareNodesNumerically:function(e,r){var t=s.computeWithApproxNumericValue(e),i=s.computeWithApproxNumericValue(r);return"number"!==t.type||"number"!==i.type?errorNode:t.value-i.value},computeWithApproxNumericValue:function(e){var r=e;if("unary"===e.type){var t=s.computeWithApproxNumericValue(e.child);r=s.operatorProperties[e.op].unaryEvaluate(t)}if("compound"===e.type){var i=s.computeWithApproxNumericValue(e.lhs),o=s.computeWithApproxNumericValue(e.rhs);if(0===s.getPrecedence(e.op))return expr.createCompoundExpression(i,o,e.op);r=s.operatorProperties[e.op].evaluate(i,o)}if("ternary"===e.type){var n=s.computeWithApproxNumericValue(e.left),a=s.computeWithApproxNumericValue(e.middle),p=s.computeWithApproxNumericValue(e.right);return expr.createTernaryExpression(n,a,p,e.op1,e.op2)}return"number"===r.type?expr.createSimpleExpression("number",fractionUtils.computeApproxNumericValue(r.value)):s.copyNode(e)},rationalizeDenominator:function(e){if("number"===e.type&&fractionUtils.isValueFraction(e.value)&&fractionUtils.isValueRadical(e.value.bottom)&&(e=expr.createCompoundExpression(expr.createSimpleExpression("number",e.value.top),expr.createSimpleExpression("number",e.value.bottom),"/")),"compound"!==e.type||"/"!==e.op)return e;var r=i(e.rhs);if(null===r.radical)return e;var t=r.radical;"compound"===t.type&&(t=n(t)),t.value.power=s.operatorProperties["-"].evaluateValues(1,t.value.power).value;var o=s.makeNumber(t.value.radicand);return null!==r.rest&&(o=s.operatorProperties["*"].evaluate(r.rest,o)),s.operatorProperties["/"].evaluate(s.operatorProperties["*"].evaluate(e.lhs,t),o)},makeNumber:function(e){return s.createSimpleExpression("number",e)},operatorProperties:{"^":new e(1,3,!1,!1,function(e,r){return"number"!==e.type||"number"!==r.type||fractionUtils.isValueRadical(r.value)?s.createCompoundExpression(e,r,"^"):1===e.value?e:s.operatorProperties["^"].evaluateValues(e.value,r.value)},function(e,r){if(fractionUtils.isValueFraction(r)){var t=o(fractionUtils.createRadicalValue(e,r,!1));return t}var i=1;return fractionUtils.isValueFraction(e)?s.operatorProperties["/"].evaluate(s.operatorProperties["^"].evaluateValues(e.top,r),s.operatorProperties["^"].evaluateValues(e.bottom,r)):fractionUtils.isValueRadical(e)?o(fractionUtils.createRadicalValue(e.radicand,s.operatorProperties["*"].evaluateValues(e.power,r).value,!1)):(i=fractionUtils.isNegative(r)?fractionUtils.createFractionValue(1,Math.pow(e,-1*r)):Math.pow(e,r),s.createSimpleExpression("number",i))}),"/":new e(1,2,!1,!1,function(e,r){if(!(e.numeric&&r.numeric||e.simplified&&r.simplified))return s.createCompoundExpression(e,r,"/");if("number"!==e.type||"number"!==r.type){var t=expr.createCompoundExpression(e,r,"/");return t.simplified=!0,t}return s.operatorProperties["/"].evaluateValues(e.value,r.value)},function(e,r){var t=null;if(fractionUtils.isValueRadical(r))return s.operatorProperties["*"].evaluate(expr.createSimpleExpression("number",e),s.rationalizeDenominator(expr.createSimpleExpression("number",fractionUtils.invertFraction(r))));if(fractionUtils.isValueRadical(e)){var i=expr.createCompoundExpression(expr.createSimpleExpression("number",e),expr.createSimpleExpression("number",r),"/");return i.simplified=!0,i}return fractionUtils.isValueFraction(r)?s.operatorProperties["*"].evaluateValues(e,fractionUtils.invertFraction(r)):fractionUtils.isValueFraction(e)?s.operatorProperties["/"].evaluate(s.makeNumber(e.top),s.operatorProperties["*"].evaluateValues(e.bottom,r)):(t=fractionUtils.simplifyFraction(fractionUtils.createFractionValue(e,r)),s.createSimpleExpression("number",t))}),"*":new e(1,2,!0,!0,function(e,r){if(!e.numeric||!r.numeric)return s.createCompoundExpression(e,r,"*");if("compound"===e.type&&2===getPrecedence(e.op)){if("number"===e.lhs.type&&!fractionUtils.isValueRadical(e.lhs.value))return s.operatorProperties[e.op].evaluate(s.operatorProperties["*"].evaluate(e.lhs,r),e.rhs);if("number"===e.rhs.type&&!fractionUtils.isValueRadical(e.rhs.value))return s.operatorProperties["*"].evaluate(e.lhs,s.operatorProperties[e.op].evaluate(r,e.rhs))}if("compound"===r.type&&2===getPrecedence(r.op)){if("number"===r.lhs.type&&!fractionUtils.isValueRadical(r.lhs.value))return s.operatorProperties[r.op].evaluate(s.operatorProperties["*"].evaluate(e,r.lhs),r.rhs);if("number"===r.rhs.type&&!fractionUtils.isValueRadical(r.rhs.value))return s.operatorProperties["*"].evaluate(s.operatorProperties[r.op].evaluate(e,r.rhs),r.lhs)}return"number"!==e.type||"number"!==r.type?s.createCompoundExpression(e,r,"*"):s.operatorProperties["*"].evaluateValues(e.value,r.value)},function(e,r){return fractionUtils.isValueRadical(e)&&!e.simplified?s.operatorProperties["*"].evaluate(o(e),s.makeNumber(r)):fractionUtils.isValueRadical(r)&&!r.simplified?s.operatorProperties["*"].evaluate(s.makeNumber(e),o(r)):fractionUtils.isValueRadical(e)||fractionUtils.isValueRadical(r)?n(s.createCompoundExpression(s.makeNumber(e),s.makeNumber(r),"*")):s.createSimpleExpression("number",fractionUtils.multiplyFractions(e,r))}),"-":new e(0,1,!1,!1,function(e,r){return"number"!==e.type||"number"!==r.type||fractionUtils.isValueRadical(e.value)||fractionUtils.isValueRadical(r.value)?s.createCompoundExpression(e,r,"-"):s.operatorProperties["-"].evaluateValues(e.value,r.value)},function(e,r){var t=null;return fractionUtils.isValueFraction(e)||fractionUtils.isValueFraction(r)?s.operatorProperties["+"].evaluateValues(e,this.unaryEvaluateValues(r).value):(t=e-r,s.createSimpleExpression("number",t))}),"+":new e(0,1,!0,!0,function(e,r){if("number"!==e.type||"number"!==r.type)return s.createCompoundExpression(e,r,"+");if(fractionUtils.isValueRadical(e.value)||fractionUtils.isValueRadical(r.value)){if(e.syntacticEquals(r)){var t=s.createCompoundExpression(s.makeNumber(2),e,"*");return t.simplified=!0,t}return s.createCompoundExpression(e,r,"+")}return s.operatorProperties["+"].evaluateValues(e.value,r.value)},function(e,r){var t=null;return fractionUtils.isValueFraction(e)||fractionUtils.isValueFraction(r)?(fractionUtils.isValueFraction(e)||(e=fractionUtils.createFractionValue(e,1)),fractionUtils.isValueFraction(r)||(r=fractionUtils.createFractionValue(r,1)),t=fractionUtils.addFractions(e,r)):t=e+r,s.createSimpleExpression("number",t)}),"\\sqrt":new e(0,-1,!1,!1,function(e,r){return s.operatorProperties["^"].evaluate(r,s.operatorProperties["/"].evaluateValues(1,e.value))},function(e,r){return s.operatorProperties["^"].evaluate(s.makeNumber(r),s.operatorProperties["/"].evaluateValues(1,e))}),"|":{precedence:-1,commutative:!1,associative:!1,unaryEvaluate:function(e){return s.makeNumber(fractionUtils.abs(e.value))}},"=":{precedence:0,commutative:!0,associative:!1},"!=":{precedence:0,commutative:!0,associative:!1},"<":{precedence:0,commutative:!1,associative:!1},">":{precedence:0,commutative:!1,associative:!1},"<=":{precedence:0,commutative:!1,associative:!1},">=":{precedence:0,commutative:!1,associative:!1},getInverseInequality:function(e){return"<"===e?">":">"===e?"<":"<="===e?">=":">="===e?"<=":"="===e?"=":""},getDirection:function(e){return"<"===e?"less":">"===e?"greater":"<="===e?"less":">="===e?"greater":""},inverseOp:function(e){switch(e){case"+":return"-";case"-":return"+";case"*":return"/";case"/":return"*"}}},getPrecedence:function(e){return e=r(e),s.operatorProperties[e].precedence},nextId:0,nodeMap:"undefined"==typeof window?null:{},makeIntoFractionNodeIfApplicable:function(e){if(!utils.isNumericFraction(e))return e;var r=fractionUtils.simplifyFraction(fractionUtils.createFractionValue(e.lhs.value,e.rhs.value));return r===errorNode?errorNode:s.createSimpleExpression("number",r)},copyNode:function(e){return utils.isSimpleExpression(e)?s.createSimpleExpression(e.type,e.value):"unary"===e.type?s.createUnaryExpression(s.copyNode(e.child),e.op):s.createCompoundExpression(s.copyNode(e.lhs),s.copyNode(e.rhs),e.op)},makeAdditionCommutative:function(e){return null!==e&&"compound"===e.type&&"-"===e.op?s.createCompoundExpression(s.copyNode(e.lhs),s.createUnaryExpression(s.copyNode(e.rhs),"-"),"+"):e},makeCommutativeIfNecessary:function(e){return null===e||"compound"!==e.type||"/"!==e.op||utils.isOneOverSomething(e)?s.makeAdditionCommutative(e):s.createCompoundExpression(s.copyNode(e.lhs),s.createCompoundExpression(s.createSimpleExpression("number",1),s.copyNode(e.rhs),"/"),"*")},makeCommutativeIfNecessaryRec:function(e,r){if(("compound"===e.type||"ternary"===e.type)&&getPrecedence(e.op)===getPrecedence(r)){var t=e;return"compound"===e.type&&(t=s.createCompoundExpression(s.makeCommutativeIfNecessaryRec(e.lhs,r),s.makeCommutativeIfNecessaryRec(e.rhs,r),e.op)),"ternary"===e.type&&(t=s.createTernaryExpression(s.makeCommutativeIfNecessaryRec(e.left,r),s.makeCommutativeIfNecessaryRec(e.middle,r),s.makeCommutativeIfNecessaryRec(e.right,r),e.op1,e.op2)),s.makeCommutativeIfNecessary(t)}return e},arithmeticEvaluation:function(e,r){if(e.simplified)return e;var t=expr.rationalizeDenominator(e);if(!e.syntacticEquals(t))return t;if("number"===e.type&&fractionUtils.isValueFraction(e.value))return t=s.createSimpleExpression("number",fractionUtils.simplifyFraction(e.value)),t.simplified=!0,t;if("number"===e.type&&fractionUtils.isValueRadical(e.value))return o(e.value);if("unary"===e.type){if("number"===e.child.type){if(fractionUtils.isValueRadical(e.child.value))return t;t=s.operatorProperties[e.op].unaryEvaluate(e.child)}else{var i=s.arithmeticEvaluation(e.child);if(utils.isUnaryNegative(e)&&utils.isUnaryNegative(i))return i.child;t=r&&utils.isUnaryNegative(e)?s.createCompoundExpression(s.createSimpleExpression("number",-1),i,"*"):s.createUnaryExpression(i,e.op)}return t}if("compound"!==e.type||0===s.getPrecedence(e.op))return e;if(e.lhs=s.makeIntoFractionNodeIfApplicable(e.lhs),e.rhs=s.makeIntoFractionNodeIfApplicable(e.rhs),e.lhs===errorNode||e.rhs===errorNode)return errorNode;if(t=expr.createCompoundExpression(e.lhs,e.rhs,e.op),e.lhs.numeric&&e.rhs.numeric){if(!("number"===e.lhs.type||"number"===e.rhs.type||e.lhs.simplified&&e.rhs.simplified))return t;if(t=s.operatorProperties[e.op].evaluate(e.lhs,e.rhs),!t.syntacticEquals(e))return t.simplified=!0,t}if("number"===e.rhs.type&&e.rhs.value===s.operatorProperties[e.op].identity)t=e.lhs;else if("number"===e.rhs.type&&0===e.rhs.value){if("*"===e.op&&(t=e.rhs),"^"===e.op&&(t=s.createSimpleExpression("number",1)),"/"===e.op)return errorNode}else 2===s.getPrecedence(e.op)&&utils.isNegativeOne(e.rhs)&&!r?t=s.createUnaryExpression(e.lhs,"-"):"*"===e.op&&utils.isNegativeOne(e.lhs)&&!r?t=s.createUnaryExpression(e.rhs,"-"):"^"===e.op&&utils.isNegativeOne(e.rhs)&&!r?t=s.createCompoundExpression(s.createSimpleExpression("number",1),e.lhs,"/"):(e=s.makeCommutativeIfNecessary(e),"number"===e.lhs.type&&(s.operatorProperties[e.op].commutative&&e.lhs.value===s.operatorProperties[e.op].identity?t=e.rhs:0===e.lhs.value&&s.operatorProperties[e.op].precedence>1&&(t=e.lhs)));return t},createExpression:function(e,r){var t=s.nextId++,i="number"===e,o={id:t,type:e,parent:null,numeric:r,simplified:i,syntacticEquals:function(e){return this.type!==e.type?!1:utils.isSimpleExpression(this)?fractionUtils.compareFractions(this.value,e.value,!1):"ternary"===this.type?this.op1===e.op2&&this.op2===e.op2&&this.left.syntacticEquals(e.left)&&this.middle.syntacticEquals(e.middle)&&this.right.syntacticEquals(e.right):this.op!==e.op?!1:"unary"===this.type?this.child.syntacticEquals(e.child):"compound"===this.type?this.lhs.syntacticEquals(e.lhs)&&this.rhs.syntacticEquals(e.rhs):!1},evaluateArithmetic:function(e){if(this.simplified)return null;var r=this.parent,t=utils.getSide(this),i=s.copyNode(this),o=s.arithmeticEvaluation(this,e);return o===errorNode?errorNode:o.syntacticEquals(i)?null:(utils.setChild(o,r,t),o)},combineEqualExpressions:function(){var e=null;if("compound"===this.type&&this.lhs.syntacticEquals(this.rhs)&&"^"!==this.op){var r=this.parent,t=utils.getSide(this);"+"===this.op?e=s.createCompoundExpression(s.createSimpleExpression("number",2),this.lhs,"*"):"-"===this.op?e=s.createSimpleExpression("number",0):"/"===this.op?e=s.createSimpleExpression("number",1):"*"===this.op&&(e=s.createCompoundExpression(this.lhs,s.createSimpleExpression("number",2),"^")),utils.setChild(e,r,t)}return e},associate:function(){var r=null;if("compound"===e){var t=this.parent;if(null===t)return null;var i=utils.getSide(this);if(s.getPrecedence(this.op)!==s.getPrecedence(t.op)||"right"===i&&this.op!==t.op)return null;var o=t.parent,n=utils.getSide(t),a=this;if("left"===i&&(a=s.makeCommutativeIfNecessary(this)),a.op===t.op&&!s.operatorProperties[a.op].associative)return null;utils.setChild(a,t,i);var p=t.lhs;if(a===p){p=t.rhs;var u=s.createCompoundExpression(a.rhs,p,t.op);r=s.createCompoundExpression(a.lhs,u,a.op)}else{var l=s.createCompoundExpression(p,a.lhs,t.op);r=s.createCompoundExpression(l,a.rhs,a.op)}utils.setChild(r,o,n)}return r},commute:function(){var r=this.parent,t=utils.getSide(this),i=s.makeCommutativeIfNecessary(this);if("compound"===e&&s.operatorProperties[i.op].commutative){var o=s.createCompoundExpression(i.rhs,i.lhs,i.op);return utils.setChild(o,r,t),o}return null},distributeLeft:function(){var e=null;if("compound"===this.type&&"*"===this.op){var r=this.parent,t=utils.getSide(this);"compound"===this.rhs.type&&1===s.getPrecedence(this.rhs.op)&&(e=s.createCompoundExpression(s.createCompoundExpression(this.lhs,this.rhs.lhs,this.op),s.createCompoundExpression(this.lhs,this.rhs.rhs,this.op),this.rhs.op)),utils.setChild(e,r,t)}return e},distributeRight:function(){var e=null;if("compound"===this.type&&"*"===this.op||"/"===this.op){var r=this.parent,t=utils.getSide(this);"compound"===this.lhs.type&&1===s.getPrecedence(this.lhs.op)&&(e=s.createCompoundExpression(s.createCompoundExpression(this.lhs.lhs,this.rhs,this.op),s.createCompoundExpression(this.lhs.rhs,this.rhs,this.op),this.lhs.op)),utils.setChild(e,r,t)}return e},factorLeft:function(){var e=null;if("compound"===this.type&&1===s.getPrecedence(this.op)){var r=s.makeCommutativeIfNecessary(this.lhs),t=s.makeCommutativeIfNecessary(this.rhs);if("compound"===this.lhs.type&&2===s.getPrecedence(r.op)&&"compound"===t.type&&t.op===r.op&&r.lhs.syntacticEquals(t.lhs)){var i=this.parent,o=utils.getSide(this);e=s.createCompoundExpression(r.lhs,s.createCompoundExpression(r.rhs,t.rhs,this.op),r.op),utils.setChild(e,i,o)}}return e},factorRight:function(){var e=null;if("compound"===this.type&&1===s.getPrecedence(this.op)&&"compound"===this.lhs.type&&2===s.getPrecedence(this.lhs.op)&&"compound"===this.rhs.type&&this.rhs.op===this.lhs.op&&this.lhs.rhs.syntacticEquals(this.rhs.rhs)){var r=this.parent,t=utils.getSide(this);e=s.createCompoundExpression(s.createCompoundExpression(this.lhs.lhs,this.rhs.lhs,this.op),this.lhs.rhs,this.lhs.op),utils.setChild(e,r,t)}return e}};return null!==s.nodeMap&&(s.nodeMap[t]=o),o},createSimpleExpression:function(e,r){var t="number"===e,i=s.createExpression(e,t);return i.value=r,t&&"number"!=typeof r&&(i.simplified=!1),i},createCompoundExpression:function(e,t,i){if(e===errorNode||t===errorNode)return errorNode;var o=s.createExpression("compound",e.numeric&&t.numeric);return o===errorNode?errorNode:(o.lhs=e,o.rhs=t,i=r(i),o.op=i,e.parent=o,t.parent=o,o)},createTernaryExpression:function(e,t,i,o,n){if(e===errorNode||t===errorNode||i===errorNode)return errorNode;var a=s.createExpression("ternary",e.numeric&&t.numeric&&i.numeric);return a===errorNode?errorNode:(a.left=e,a.middle=t,a.right=i,o=r(o),a.op1=o,n=r(n),a.op2=n,a.op=o,e.parent=a,i.parent=a,a)},createUnaryExpression:function(e,r){if(e===errorNode)return errorNode;var t=s.createExpression("unary",e.numeric);return t.child=e,t.op=r,e.parent=t,t}};return s.operatorProperties["-"].unaryEvaluate=function(e){return s.operatorProperties["*"].evaluate(s.createSimpleExpression("number",-1),e)},s.operatorProperties["-"].unaryEvaluateValues=function(e){return s.operatorProperties["*"].evaluateValues(-1,e)},s.operatorProperties["\\sqrt"].unaryEvaluate=function(e,r){return r===void 0&&(r=!1),s.operatorProperties["^"].evaluateValues(e.value,fractionUtils.createFractionValue(1,2))},s}(),operatorProperties=expr.operatorProperties,getPrecedence=expr.getPrecedence;if("undefined"!=typeof exports&&(exports.expr=expr,exports.operatorProperties=expr.operatorProperties,exports.getPrecedence=expr.getPrecedence),"undefined"!=typeof module&&"undefined"!=typeof require)var utils=require("./utils.js").utils,errorNode=require("./utils.js").errorNode;var fractionUtils=function(){function e(e){if(!t.isInteger(e))return[];e=Math.abs(e);for(var i=[],o=0;r.length>o;o++){for(var n=e/r[o],s=[r[o],0];t.isInteger(n);)s[1]++,e=n,n=e/r[o];if(0!==s[1]&&i.push(s),1===e)return i}return 1!==e&&console.error("The number was too big to factor"),i}var r=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],t={isInteger:function(e){return e===Math.floor(e)},isEven:function(e){return Math.floor(e/2)===e/2},getGcd:function(e,r){return 0===e%r?r:t.getGcd(r,e%r)},getLcm:function(e,r){return e*r/t.getGcd(e,r)},numericalRoot:function(e,r){return r===void 0&&(r=.5),t.isValueFraction(r)&&(r=r.top/r.bottom),fractionUtils.isValueFraction(e)?fractionUtils.simplifyFraction(t.createFractionValue(Math.pow(e.top,r),Math.pow(e.bottom,r))):Math.pow(e,r)},combineRadicals:function(e,r){if(fractionUtils.isValueRadical(e)&&fractionUtils.isValueRadical(r)){if(!fractionUtils.compareFractions(e.power,r.power)){if(fractionUtils.isValueRadical(e.power)||fractionUtils.isValueRadical(r.power))return errorNode;if(e.power=fractionUtils.simplifyFraction(e.power),r.power=fractionUtils.simplifyFraction(r.power),e.power.bottom!==r.power.bottom){var i=fractionUtils.getLcm(e.power.bottom,r.power.bottom);e.power=fractionUtils.createFractionValue(e.power.top*i/e.power.bottom,i),r.power=fractionUtils.createFractionValue(r.power.top*i/r.power.bottom,i)}1!==e.power.top&&(e.radicand=Math.pow(e.radicand,e.power.top),e.power.top=1),1!==r.power.top&&(r.radicand=Math.pow(r.radicand,r.power.top),r.power.top=1)}return t.createRadicalValue(t.multiplyFractions(e.radicand,r.radicand),e.power)}return errorNode},simplifyRadical:function(r){if(r.simplified)return r;if(r.simplified=!0,t.isValueRadical(r.power))return r;var i=t.numericalRoot(r.radicand,r.power);if(t.isInteger(i)||t.isValueFraction(i)&&t.isInteger(i.top)&&t.isInteger(i.bottom))return i;if(!t.isValueFraction(r.power))return r;var o=r.power.bottom;if(!t.isInteger(o))return r;var n=t.createRadicalValue(t.numericalRoot(r.radicand,r.power.top),t.createFractionValue(1,o),!0),s=t.createMixedValue(1,n),a=e(o);if(a.length>1)for(var p=0;a.length>p;p++)for(;a[p][1]>0;){var u=t.createRadicalValue(s.radical.radicand,t.createFractionValue(1,a[p][0])),l=t.simplifyRadical(u);if(!fractionUtils.isValueFraction(l)&&!t.isInteger(l))break;s.rational=t.multiplyFractions(s.rational,u),s.radical.power=t.createFractionValue(1,s.radical.power/a[p][0]),a[p][1]--}for(var c=e(n.radicand),d=0;c.length>d;d++)for(;c[d][1]>=o;)s.rational*=c[d][0],s.radical.radicand/=Math.pow(c[d][0],o),c[d][1]-=o;return 1===s.radical.radicand?s.rational:1===s.rational?s.radical:s},abs:function(e){return t.isValueFraction(e)?t.createFractionValue(Math.abs(e.top),Math.abs(e.bottom)):Math.abs(e)},fractionGCD:function(e,r){return t.isValueRadical(e)||t.isValueRadical(r)?1:(e=t.simplifyFraction(e),r=t.simplifyFraction(r),t.compareFractions(e,r,!0)?e:t.isValueFraction(e)&&t.isValueFraction(r)?e.bottom===r.bottom?t.createFractionValue(t.getGcd(e.top,r.top),e.bottom):1:t.isValueFraction(e)?t.getGcd(e.top,r):t.isValueFraction(r)?t.getGcd(e,r.top):t.getGcd(e,r))},multiplyFractions:function(e,r){return fractionUtils.isValueFraction(r)&&fractionUtils.isValueFraction(e)?fractionUtils.simplifyFraction(fractionUtils.createFractionValue(e.top*r.top,e.bottom*r.bottom)):fractionUtils.isValueFraction(e)?t.multiplyFractions(r,e):fractionUtils.isValueFraction(r)?fractionUtils.simplifyFraction(fractionUtils.createFractionValue(e*r.top,r.bottom)):e*r
},addFractions:function(e,r){if(e.bottom!==r.bottom){var i=t.getLcm(e.bottom,r.bottom);e=t.createFractionValue(e.top*i/e.bottom,i),r=t.createFractionValue(r.top*i/r.bottom,i)}var o=e.top+r.top;return 0===o?0:t.simplifyFraction(t.createFractionValue(o,e.bottom))},invertFraction:function(e){return t.isValueFraction(e)?1===e.top?e.bottom:t.createFractionValue(e.bottom,e.top):t.createFractionValue(1,e)},isNegative:function(e){if(t.isValueRadical(e))return!1;var r=t.simplifyFraction(e);return t.isValueFraction(r)?0>r.top:0>r},compareFractions:function(e,r,i){if(t.isValueFraction(e)&&t.isValueFraction(r))return t.compareFractions(e.top,r.top)?t.compareFractions(e.bottom,r.bottom):!1;if(t.isValueRadical(e)&&t.isValueRadical(r))return t.compareFractions(e.radicand,r.radicand)?t.compareFractions(e.power,r.power):!1;if(i){if(t.isValueRadical(e)||t.isValueRadical(r))return!1;if(t.isValueFraction(r))return t.compareFractions(r,e,!0);if(t.isValueFraction(e)){var o=t.simplifyFraction(e);return t.compareFractions(o,e,!1)?e.top/e.bottom===r:!1}}return e===r},computeApproxNumericValue:function(e){return t.isValueMixed(e)?t.computeApproxNumericValue(e.radical)*t.computeApproxNumericValue(e.rational):t.isValueRadical(e)?t.numericalRoot(e.radicand,e.power):t.isValueFraction(e)?e.top/e.bottom:e},isValueFraction:function(e){return e.top!==void 0&&e.bottom!==void 0},isValueRadical:function(e){return e.radicand!==void 0&&e.power!==void 0},isValueMixed:function(e){return e.rational!==void 0&&e.radical!==void 0},createFractionValue:function(e,r){return{top:e,bottom:r}},createRadicalValue:function(e,r,t){return{radicand:e,power:r,simplified:t}},createMixedValue:function(e,r){return{rational:e,radical:r}},simplifyFraction:function(e){if(!t.isValueFraction(e))return e;if(t.isValueRadical(e.top)||t.isValueRadical(e.bottom))return e;if(0===e.top)return 0;if(0===e.bottom)return console.error("Attempted to divide by 0"),errorNode;if(!t.isInteger(e.top)||!t.isInteger(e.bottom))return e.top/e.bottom;var r=t.createFractionValue(e.top,e.bottom),i=t.getGcd(r.top,r.bottom);return r.top/=i,r.bottom/=i,0>r.bottom&&(r.top*=-1,r.bottom*=-1),1===r.bottom?r.top:r},isNegativeNumber:function(e){return void 0!==e&&"number"===e.type&&t.isNegative(e.value)},isNodeFraction:function(e){return"number"===e.type&&t.isValueFraction(e.value)},isNodeNegative:function(e){return utils.isUnaryNegative(e)||t.isNegativeNumber(e)},additiveInverseOfFraction:function(e){if(t.isValueRadical(e))return errorNode;if(t.isValueFraction(e)){if(t.isNegative(e.top))return t.createFractionValue(t.additiveInverseOfFraction(e.top),e.bottom);if(t.isNegative(e.bottom))return t.createFractionValue(e.top,t.additiveInverseOfFraction(e.bottom))}return-1*e}};return t}();if("undefined"!=typeof exports&&(exports.fractionUtils=fractionUtils),"undefined"!=typeof module&&"undefined"!=typeof require)var processExpressions=require("./processExpressions.js").processExpressions,errorNode=require("./utils.js").errorNode,display=require("./display.js").display,divSign=require("./display.js").divSign,parenMode=require("./display.js").parenMode,outputType=require("./display.js").outputType,equalityType=require("./evaluation.js").equalityType,evaluate=require("./evaluation.js").evaluate;var nodeWrapper=function(){var e=divSign.never,r=outputType.latex,t=parenMode.necessary,i=function(e,r){var t="";r===void 0&&(r=a);for(var i=0;e.length>i;i++)i>0&&(t+=","),t+=r(e[i]);return t},o=function(i){var o=display.displayExpression(i,r,t,e);return o},n=function(e){switch(e){case equalityType.verbatim:return"verbatim";case equalityType.commuteCo:return"commuteCo";case equalityType.commute:return"commute";case equalityType.full:return"full";case equalityType.fullEq:return"fullEq";case equalityType.none:return"none"}return"unknown"},s=function(e){return"number"!=typeof e?"incomparable":0===e?"=":0>=e?"<":">"},a=function(e){return e===errorNode?"error":e},p={runCommand:function(t,a){if(e=divSign.never,"parse"===t)return i(a,o);if("simplify"===t)return i(processExpressions.simplifyExpressions(a),o);if("simplifyNumeric"===t)return i(processExpressions.simplifyExpressionsNumeric(processExpressions.simplifyExpressions(a)),o);if("simplifyShowDiv"===t)return e=divSign.notNumeric,i(processExpressions.simplifyExpressions(a),o);if("verbatim"===t)return processExpressions.checkVerbatimEquality(a);if("commute"===t)return processExpressions.checkCommuteEquality(a);if("commuteCo"===t)return processExpressions.checkCommuteEqualityCoefficient(a);if("full"===t)return processExpressions.checkFullEquality(a);if("fullEq"===t)return processExpressions.checkFullEqualityEquationOrInequality(a);if("polydiv"===t)return i(processExpressions.dividePolynomials(a),o);if("eqBreakdown"===t)return i(processExpressions.strictestEquality(a,!0),n);if("eqBreakdownNoFullEq"===t)return i(processExpressions.strictestEquality(a,!1),n);if("solve"===t)return i(processExpressions.solve(a),o);if("compare"===t)return i(processExpressions.compare(a));if("compareOp"===t)return i(processExpressions.compare(a),s);if("compute"===t)return i(processExpressions.compute(a));if("getIdentifiers"===t)return 1!==a.length?"need exactly one expression":i(evaluate.getAllIdentifiers(a[0]));if("getTerms"===t||"getTermsNoSort"===t){if(1!==a.length)return"need exactly one expression";var p="getTerms"===t,u=evaluate.getAllTermsAtLevel(a[0],p);u.operator===void 0&&(u.operator="none"),r=outputType.text;var l=u.operator+","+i(u.terms,o);return r=outputType.latex,l}return"Unknown command: "+t}};return p}();if("undefined"!=typeof process&&process.argv.length>3){var command=process.argv[2],newline=!1,start=3;"newline"===process.argv[3]&&(newline=!0,start=4);var expressions=process.argv.splice(start),parsedExpessions=processExpressions.parseExpressions(expressions),result=nodeWrapper.runCommand(command,parsedExpessions);newline?console.log(result):process.stdout.write(""+result)}if("undefined"!=typeof exports&&(exports.nodeWrapper=nodeWrapper),"undefined"!=typeof module&&"undefined"!=typeof require)var fractionUtils=require("./fractionUtils.js").fractionUtils,utils=require("./utils.js").utils,expr=require("./expr.js").expr,errorNode=require("./utils.js").errorNode,operatorProperties=require("./expr.js").operatorProperties;var parser=function(){function e(e){switch(e){case"{":return"}";case"[":return"]";case"(":return")";default:return")"}}function r(r,t){for(var i=e(t),o=0,n=0;r.length>n;n++){if(r.charAt(n)===i&&o--,r.charAt(n)===t&&o++,0===o)return n;if(0>o)break}return console.error("Mismatched parentheses!"),-1}function t(e){for(var r=1,t=0;e.length-3>t;t++){var i=e.substring(t);if(b.test(i)&&r--,g.test(i)&&r++,0===r)return t;if(0>r)break}return console.error("Mismatched absolute value!"),-1}function i(e){for(var r=1,t=0;e.length-3>t;t++){var i=e.substring(t);if(E.test(i)&&r--,y.test(i)&&r++,0===r)return t;if(0>r)break}return console.error("Mismatched parentheses!"),-1}function o(e,r,t){return"/"!==t||"number"!==e.type||"number"!==r.type||fractionUtils.isValueFraction(e.value)||fractionUtils.isValueFraction(r.value)?expr.createCompoundExpression(e,r,t):0===r.value?(console.error("Divided by 0"),errorNode):expr.createSimpleExpression("number",fractionUtils.createFractionValue(e.value,r.value))}function n(e,r){if(-1===r)return null;var t=u(e.substring(1,r),0);return t===errorNode||t.expression===errorNode?errorNode:{expression:t.expression,expressionString:e.substring(r+1)}}function s(e,t){if(e.charAt(0)!==t)return console.error("Badly formed LaTeX input"),errorNode;var i=r(e,t);return n(e,i)}function a(e,r){return r===void 0&&(r=fractionUtils.createFractionValue(1,2)),expr.createSimpleExpression("number",fractionUtils.createRadicalValue(e,r,!1))}function p(e){var p={expression:null,expressionString:e},l=-1;if("-"===e.charAt(0)){var c=/\d/.test(e.charAt(1))?2:1,E=u(e.substring(1),c);if(E.expression===errorNode)return errorNode;p.expressionString=E.expressionString,p.expression=expr.createUnaryExpression(E.expression,"-"),"number"===E.expression.type&&(fractionUtils.isNegative(E.expression.value)||"number"!=typeof E.expression.value||(p.expression=expr.createSimpleExpression("number",-1*E.expression.value)))}else if("i"===e.charAt(0))p.expression=a(-1),p.expressionString=e.substring(1);else if("("===e.charAt(0)||"{"===e.charAt(0))l=r(e,e.charAt(0)),p=n(e,l);else if("\\"===e.charAt(0))if(x.test(e))p.expressionString=e.substring(6),p.expression=expr.createSimpleExpression("identifier","\\infty");else if(v.test(e)){e=e.substring(5);var b=e.charAt(0),C=s(e,b);if("["===b){var U=C;C=s(C.expressionString,"{"),p.expression=expr.createCompoundExpression(U.expression,C.expression,"\\sqrt"),"number"===p.expression.lhs.type&&"number"===p.expression.rhs.type&&(p.expression=a(p.expression.rhs.value,fractionUtils.invertFraction(p.expression.lhs.value)))}else p.expression="number"===C.expression.type?a(C.expression.value):expr.createUnaryExpression(C.expression,"\\sqrt");p.expressionString=C.expressionString}else if(h.test(e)){e=e.substring(5);var q=s(e,"{"),V=s(q.expressionString,"{");if(p.expression=o(q.expression,V.expression,"/"),p.expression===errorNode)return errorNode;p.expressionString=V.expressionString}else if(y.test(e)){e=e.substring(6);var P=i(e);p={expression:u(e.substring(0,P),0).expression,expressionString:e.substring(P+7)}}else if(g.test(e)){e=e.substring(6);var S=t(e);p={expression:u(e.substring(0,S),0).expression,expressionString:e.substring(S+7)},p.expression!==errorNode&&(p.expression=expr.createUnaryExpression(p.expression,"|"))}else{var F=e.match(/^\\[a-z]+/i)[0];if(0===F.length)return console.error("Unknown function starting at: "+e),errorNode;p.expression=expr.createSimpleExpression("identifier",F),p.expressionString=e.substring(F.length)}else{var R="identifier",w=e.charAt(0),T=e.match(d);if(null!==T){if(R="number",w=parseFloat(T),isNaN(w))return console.error("Badly formed number: "+T),errorNode;p.expressionString=e.substring(T[0].length)}else if(p.expressionString=e.substring(1),!m.test(w))return console.error("Badly formed identifier: "+w),errorNode;p.expression=expr.createSimpleExpression(R,w)}return null===p||p===errorNode||p.expression===errorNode?errorNode:p.expression===errorNode?errorNode:(p.expressionString=p.expressionString.replace(N,""),f.test(p.expressionString.charAt(0))&&(p.expressionString="*"+p.expressionString),p)}function u(e,r){e=e.replace(N,"");for(var t=p(e);t!==errorNode&&0!==t.expressionString.length&&l.test(t.expressionString.charAt(0))&&operatorProperties[t.expressionString.charAt(0)].precedence>r;){var i=t.expressionString.charAt(0),n=u(t.expressionString.substring(1),operatorProperties[i].precedence);if(n===errorNode)return errorNode;t.expression=o(t.expression,n.expression,i),t.expressionString=n.expressionString}return t}var l=RegExp(/\+|\-|\*|\/|\^/),c=RegExp(/<=|=|>=|!=|<|>/g),d=RegExp(/^\d+\.?\d*|^\.\d+/),m=RegExp(/^[a-zA-Z]$/),f=RegExp(/^(\w|\(|\\)/),h=RegExp(/^\\frac/),x=RegExp(/^\\infty/),v=RegExp(/^\\sqrt/),y=RegExp(/^\\left\(/),E=RegExp(/^\\right\)/),g=RegExp(/^\\left\|/),b=RegExp(/^\\right\|/),N=RegExp(/^(\\:|\s)+/),C=RegExp(/(\\cdot|\\times)/g),U=RegExp(/(\\div)/g),q=RegExp(/(\\le)([^f])/g),V=RegExp(/\\ge/g),P=RegExp(/\\ne/g),S={parseExpressionWrapper:function(e){e=e.replace(C,"*"),e=e.replace(U,"/");var r=u(e,0,1);return r===errorNode?errorNode:""!==r.expressionString?(console.error("Expression contained extra characters: "+r.expressionString),errorNode):r.expression},parseEquation:function(e){var r=e.match(c);if(null===r||1!==r.length&&2!==r.length)return console.error('Please enter an equation, not an expression (should contain an "=" or inequality).'),errorNode;if(2===r.length){if("="===r[0]||"="===r[1])return console.error("Equation is not valid."),errorNode;if(operatorProperties.getDirection(r[0])!==operatorProperties.getDirection(r[1]))return console.error("Both inequalities must face the same direction."),errorNode}var t=e.indexOf(r[0]),i=e.substring(0,t);e=e.substring(t+r[0].length);var o=2===r.length?e.indexOf(r[1]):e.length,n=S.parseExpressionWrapper(i),s=S.parseExpressionWrapper(e.substring(0,o));if(1===r.length)return expr.createCompoundExpression(n,s,r[0]);var a=s;return s=S.parseExpressionWrapper(e.substring(o+r[1].length)),expr.createTernaryExpression(n,a,s,r[0],r[1])},parseEquationOrExpression:function(e){if(e===void 0||null===e||0===e.length)return errorNode;e=e.replace(q,"<=$2"),e=e.replace(V,">="),e=e.replace(P,"!="),e=e.replace(/(\^)([^\{\(])/g,"^{$2}");var r=e.match(c);return null===r?S.parseExpressionWrapper(e):S.parseEquation(e)}};return S}();if("undefined"!=typeof exports&&(exports.parser=parser),"undefined"!=typeof module&&"undefined"!=typeof require)var parser=require("./parser.js").parser,evaluate=require("./evaluation.js").evaluate,equality=require("./equality.js").equality,expr=require("./expr.js").expr,errorNode=require("./utils.js").errorNode;var processExpressions=function(){function e(e,r){for(var t=[],i=0;e.length>i;i++)t.push(r(e[i]));return t}function r(e,r){for(var t=[],i=0;e.length-1>i;i+=2)t.push(r(e[i],e[i+1]));return t}var t={parseExpressions:function(r){return e(r,parser.parseEquationOrExpression)},checkVerbatimEquality:function(e){for(var r=0;e.length-1>r;r++){if(e[r]===errorNode)return!1;if(!e[r].syntacticEquals(e[r+1]))return!1}return e.length>1},checkCommuteEquality:function(e){for(var r=0;e.length-1>r;r++)if(!equality.equivalentModuloCommutativity(e[r],e[r+1],!1))return!1;return e.length>1},checkCommuteEqualityCoefficient:function(e){for(var r=0;e.length-1>r;r++)if(!equality.equivalentModuloCommutativity(e[r],e[r+1],!0))return!1;return e.length>1},checkFullEquality:function(e){for(var r=[],t=0;e.length>t;t++){var i=evaluate.evaluateRec(e[t]);r.push(null===i?e[t]:i)}for(var o=0;e.length-1>o;o++)if(!equality.equivalentModuloCommutativity(r[o],r[o+1]))return!1;return r.length>1},checkFullEqualityEquationOrInequality:function(e){for(var r=0;e.length-1>r;r++)if(!evaluate.equivalentEquationOrInequality(e[r],e[r+1]))return!1;return e.length>1},simplifyExpressions:function(r){return e(r,evaluate.evaluateRec)},simplifyExpressionsNumeric:function(r){return e(r,expr.computeWithApproxNumericValue)},dividePolynomials:function(e){for(var r=[],t=0;e.length-1>t;t+=2){var i=evaluate.evaluateRec(e[t]),o=evaluate.evaluateRec(e[t+1]);r.push(evaluate.doSyntheticDivision(i,o,!0))}return r},strictestEquality:function(e,t){return r(e,function(e,r){return evaluate.strictestEqualityType(e,r,t)})},solve:function(e){for(var r=[],t=0;e.length-1>t;t+=2)r=r.concat(evaluate.solveForIdentifier(e[t],e[t+1]));return r},compare:function(e){return r(e,expr.compareNodesNumerically)}};return t}();"undefined"!=typeof exports&&(exports.processExpressions=processExpressions);var errorNode={type:"error",display:function(){return"error"}},utils=function(){var e={isUnaryNegative:function(e){return"unary"===e.type&&"-"===e.op},isAbsValue:function(e){return"unary"===e.type&&"|"===e.op},setChild:function(e,r,t){e.parent=r,null!==r&&("unary"===r.type?r.child=e:"left"===t?r.lhs=e:r.rhs=e)},isOneOverSomething:function(e){return"compound"===e.type&&"/"===e.op&&"number"===e.lhs.type&&1===e.lhs.value},isNumericFraction:function(e){return"compound"===e.type&&"/"===e.op&&"number"===e.lhs.type&&"number"===e.rhs.type},isNegativeOne:function(r){return"number"===r.type&&-1===r.value||e.isUnaryNegative(r)&&1===r.child.value},isSimpleExpression:function(e){return"identifier"===e.type||"number"===e.type},getSide:function(e){return null===e.parent||e===errorNode||e.parent.lhs===e?"left":"right"}};return e}();"undefined"!=typeof exports&&(exports.utils=utils,exports.errorNode=errorNode);